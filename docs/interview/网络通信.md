# 网络通信

## 1. http 协议的状态码有哪些、含义是什么

200 OK 客户端请求成功

301 Moved Permanently（永久移除)，请求的 URL 已移走。Response 中应该包含一个 Location URL，说明资源现在所处的位置

302 found 重定向

400 Bad Request 客户端请求有语法错误，不能被服务器所理解

401 Unauthorized 请求未经授权，这个状态代码必须和 WWW-Authenticate 报头域一起使用

403 Forbidden 服务器收到请求，但是拒绝提供服务

404 Not Found 请求资源不存在，eg：输入了错误的 URL 

500 Internal Server Error 服务器发生不可预期的错误

503 Server Unavailable 服务器当前不能处理客户端的请求，一段时间后可能恢复正常

## 2. Http 的请求报文组成

 请求行：

1、是请求方法，GET 和POST 是最常见的HTTP 方法，除此以外还包括 DELETE、HEAD、OPTIONS、PUT、TRACE。

2、为请求对应的 URL 地址，它和报文头的 Host 属性组成完整的请求 URL。

3、是协议名称及版本号。

* 请求头：

  是 HTTP 的报文头，报文头包含若干个属性，格式为“属性名:属性值”，服务端据此获取客户端的信息。

  与缓存相关的规则信息，均包含在 header 中

* 请求体：

  是报文体，它将一个页面表单中的组件值通过 param1 = value1 & param2 = value2 的键值对形式编码成一个格式化串，它承载多个请求参数的数据。不但报文体可以传递请求参数，请求URL 也可以通过类似于“/chapter/user.html?param1=value1&param2=value2”的方式传递请求参数。

## 3. 一次完整的 Http 请求是怎样的

域名解析 -->  发起 TCP 的 3 次握手 -->  建立 TCP 连接后发起 http 请求 -->  服务器响应http 请求，浏览器得到 html 代码 -->  浏览器解析 html 代码，并请求 html 代码中的资源（如 js、css、图片等） --> 浏览器对页面进行渲染呈现给用户

## 4. Tcp 和 Udp 的区别

1. 基于连接与无连接；

2. 对系统资源的要求（TCP 较多，UDP 少）；

3. UDP 程序结构较简单；

4. 流模式与数据报模式 ；

5. TCP 保证数据正确性，UDP 可能丢包，TCP 保证数据顺序，UDP 不保证。

## 5. SSL 协议的三个特性

私密性：在握手协议定义了会话密钥后，所有的消息都被加密。

确认性：尽管会话的客户端认证是可选的，但是服务器端始终是被认证的。 

可靠性：传送的消息包括消息完整性检查。 

## 6. TCP 的三次握手与四次挥手

第一次握手：建立连接时，客户端发送 syn 包（syn=x）到服务器，并进入 SYN_SENT 状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。

第二次握手：服务器收到 syn 包，必须确认客户的 SYN（ack=x+1），同时自己也发送一个 SYN 包（syn=y），即 SYN+ACK 包，此时服务器进入 SYN_RECV 状态；

第三次握手：客户端收到服务器的 SYN+ACK 包，向服务器发送确认包 ACK(ack=y+1）， 此包发送完毕，客户端和服务器进入 ESTABLISHED（TCP 连接成功）状态，完成三次握手。

1） 客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其  序列号为 seq=u（等于前面已经传送过来的数据的最后一个字节的序号加 1），此时，客户端进入 FIN-WAIT-1（终止等待 1）状态。 TCP 规定，FIN 报文段即使不携带数据，也要消耗一个序号。

2） 服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号 seq=v，此时，服务端就进入了 CLOSE-WAIT（关闭等待）状态。TCP 服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个 CLOSE-WAIT 状态持续的时间。

3） 客户端收到服务器的确认请求后，此时，客户端就进入 FIN-WAIT-2（终止等待 2） 状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。

4） 服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，  由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为 seq=w，此时， 服务器就进入了 LAST-ACK（最后确认）状态，等待客户端的确认。

5） 客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的  序列号是 seq=u+1，此时，客户端就进入了 TIME-WAIT（时间等待）状态。注意此时 TCP 连接还没有释放，必须经过 2∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的 TCB 后，才进入 CLOSED 状态。

6） 服务器只要收到了客户端发出的确认，立即进入 CLOSED 状态。同样，撤销 TCB 后， 就结束了这次的 TCP 连接。可以看到，服务器结束 TCP 连接的时间要比客户端早一些。

## 7. 为什么连接的时候是三次握手，关闭的时候却是四次握手

因为当 Server 端收到 Client 端的 SYN 连接请求报文后，可以直接发送 SYN+ACK 报文。其中 ACK 报文是用来应答的，SYN 报文是用来同步的。但是关闭连接时，当 Server 端收到FIN 报文时，很可能并不会立即关闭 SOCKET，所以只能先回复一个 ACK 报文，告诉 Client 端，"你发的 FIN 报文我收到了"。只有等到我 Server 端所有的报文都发送完了，我才能发送FIN 报文，因此不能一起发送。故需要四步握手。

## 8. 如果已经建立了连接，但是客户端突然出现故障了怎么办

TCP 还设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为 2 小时，若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔 75 秒钟发送一次。若一连发送 10 个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。

## 9. http 中重定向和请求转发的区别

本质区别：转发是服务器行为，重定向是客户端行为。

重定向特点：两次请求，浏览器地址发生变化，可以访问自己 web 之外的资源，传输的数据会丢失。

请求转发特点：一次强求，浏览器地址不变，访问的是自己本身的 web 资源，传输的数据不会丢失。

## 10. GET 和 POST 的区别

1、GET 请求的数据会附在 URL 之后（就是把数据放置在 HTTP 协议头中），以?分割 URL 和传输数据，参数之间以&相连，如：login.action?name=zhagnsan&password=123456。POST 把提交的数据则放置在是 HTTP 包的包体中。

2、GET 方式提交的数据最多只能是 1024 字节，理论上 POST 没有限制，可传较大量的数据。其实这样说是错误的，不准确的：“GET 方式提交的数据最多只能是 1024 字节"，因为 GET 是通过 URL 提交数据，那么 GET 可提交的数据量就跟 URL 的长度有直接关系了。而实际上，URL 不存在参数上限的问题，HTTP 协议规范没有对 URL 长度进行限制。这个限制是特定的浏览器及服务器对它的限制。IE 对 URL 长度的限制是 2083 字节(2K+35)。对于其他浏览器，如 Netscape、FireFox 等，理论上没有长度限制，其限制取决于操作系统的支持

3、POST 的安全性要比 GET 的安全性高。注意：这里所说的安全性和上面 GET 提到的“安全”不是同个概念。上面“安全”的含义仅仅是不作数据修改，而这里安全的含义是真正的 Security 的含义，比如：通过 GET 提交数据，用户名和密码将明文出现在 URL 上，因为登录页面有可能被浏览器缓存，其他人查看浏览器的历史纪录，那么别人就可以拿到你的账号和密码了，除此之外，使用 GET 提交数据还可能会造成 Cross-site request forgery 攻击。

4、Get 是向服务器发索取数据的一种请求，而 Post 是向服务器提交数据的一种请求， 在 FORM（表单）中，Method 默认为"GET"，实质上 GET 和 POST 只是发送机制不同，并不是一个取一个发。

## 11. Http 与 Https 的区别

1、HTTP 的 URL 以 http:// 开头，而 HTTPS 的 URL 以 https:// 开头

2、HTTP 是不安全的，而 HTTPS 是安全的

3、HTTP 标准端口是 80 ，而 HTTPS 的标准端口是 443

4、在 OSI 网络模型中，HTTP 工作于应用层，而 HTTPS 的安全传输机制工作在传输层

5、HTTP 无法加密，而 HTTPS 对传输的数据进行加密

6、HTTP 无需证书，而 HTTPS 需要 CA 机构 wosign 的颁发的 SSL 证书

## 12. 什么是 Http 协议无状态协议、怎么解决 Http 协议无状态协议

无状态协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息也就是说，当客户端一次 HTTP 请求完成以后，客户端再发送一次 HTTP 请求，HTTP 并不知道当前客户端是一个”老用户“。

可以使用 Cookie 来解决无状态的问题，Cookie 就相当于一个通行证，第一次访问的时候给客户端发送一个 Cookie，当客户端再次来的时候，拿着 Cookie(通行证)，那么服务器就知道这个是”老用户“。

## 13. HTTPS 工作原理

1. 首先 HTTP 请求服务端生成证书，客户端对证书的有效期、合法性、域名是否与请求的域名一致、证书的公钥（RSA 加密）等进行校验；
2. 客户端如果校验通过后，就根据证书的公钥的有效， 生成随机数，随机数使用公钥进行加密（RSA 加密）；
3. 消息体产生的后，对它的摘要进行 MD5（或者 SHA1）算法加密，此时就得到了 RSA签名；
4. 发送给服务端，此时只有服务端（RSA 私钥）能解密。
5. 解密得到的随机数，再用 AES 加密，作为密钥（此时的密钥只有客户端和服务端知道）。

 
